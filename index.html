<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<!--<div class="board">-->
<!--    123-->
<!--    <div class="token token-red" id="token1"></div>-->
<!--    <div class="token token-red" id="token2"></div>-->
<!--    <div class="token token-red" id="token3"></div>-->
<!--    <div class="token token-red" id="token4"></div>-->
<!--    <div class="token token-red" id="token5"></div>-->
<!--</div>-->
<main>
    <div class="board">

    </div>
</main>
</body>
<script>
    // Get a reference to the Realtime Database
    // var nhietDo = document.getElementById('nhietdo');
    // var dbRef = firebase.database().ref().child('item1');
    // Reference to a specific node in the database
    // const divStateRef = database.ref('divState');

    // // Lắng nghe sự kiện từ database
    // divStateRef.on('value', (snapshot) => {
    //     const divState = snapshot.val();
    //     if (divState && divState.showDiv) {
    //         // Hiển thị div khi nhận được thông điệp từ database
    //         document.getElementById('hiddenDiv').style.display = 'block';
    //     }
    // });
    //
    // // Gửi sự kiện lên database khi click vào button
    // document.getElementById('showButton').addEventListener('click', () => {
    //     // Gửi thông điệp đến database để hiển thị div
    //     divStateRef.set({ showDiv: true });
    // });
    let boardMap = [
        [1, 1, 1, 1, 1],
        [0, 0, 0, 0, 0],
        [0, 0, 3, 0, 0],
        [0, 0, 0, 0, 0],
        [2, 2, 2, 2, 2]
    ]
    let token = {i: '', j: ''};
    const board = document.querySelector(".board")
    showBoard(boardMap)

    function showBoard(){
        let boardHtml = ''
        boardMap.forEach((row, i) => {
            row.forEach((value, j) => {
                let squareHtml = '<div class="square"></div>'
                switch (value) {
                    case -1:
                        squareHtml = `<div class="square square-step" onclick="moveStep(${i},${j})"></div>`
                        break;
                    case 1:
                        squareHtml = `<div class="square"><div class="token token-red `+ checkTokenActive(i,j) +`" onclick="showStepToken(${i},${j})"></div></div>`
                        break;
                    case 2:
                        squareHtml = `<div class="square"><div class="token token-green `+ checkTokenActive(i,j) +`" onclick="showStepToken(${i},${j})"></div></div>`
                        break;
                    case 3:
                        squareHtml = `<div class="square"><div class="token token-yellow `+ checkTokenActive(i,j) +`" onclick="showStepToken(${i},${j})"></div></div>`
                        break;
                }
                boardHtml += squareHtml
            })
        })
        board.innerHTML = boardHtml
    }

    function checkTokenActive(i,j){
        return token.i === i && token.j === j ? 'token-active' : ''
    }

    function moveStep(i,j){
        boardMap[i][j] = boardMap[token.i][token.j]
        boardMap[token.i][token.j] = 0
        removeStep()
        showBoard()
    }

    function showStepToken(i,j){
        removeStep()
        token.i = i
        token.j = j
        if(boardMap[i][j] === 3){
            checkStepOne(i,j)
        }
        else {
            checkStepUp(i,j)
            checkStepDown(i,j)
            checkStepLeft(i,j)
            checkStepRight(i,j)
            checkStepUpLeft(i,j)
            checkStepDownLeft(i,j)
            checkStepUpRight(i,j)
            checkStepDownRight(i,j)
        }
        showBoard()
    }

    function removeStep(){
        for (let row = 0; row < boardMap.length; row++) {
            for (let col = 0; col < boardMap[row].length; col++) {
                if (boardMap[row][col] === -1) {
                    boardMap[row][col] = 0;
                }
            }
        }
    }

    function checkStepOne(i,j){
        for (let row = i - 1; row <= i + 1; row++) {
            for (let col = j - 1; col <= j + 1; col++) {
                if (row >= 0 && row < boardMap.length && col >= 0 && col < boardMap[row].length) {
                    if (boardMap[row][col] === 0) {
                        boardMap[row][col] = -1;
                    }
                }
            }
        }
    }
    function checkStepUp(i,j){
        while(i > 0 && boardMap[i-1][j] === 0){
            boardMap[i-1][j] = -1;
            i--
        }
    }

    function checkStepDown(i,j){
        while(i < boardMap.length - 1 && boardMap[i+1][j] === 0){
            boardMap[i+1][j] = -1;
            i++
        }
    }

    function checkStepLeft(i,j){
        while(j > 0 && boardMap[i][j-1] === 0){
            boardMap[i][j-1] = -1;
            j--
        }
    }

    function checkStepRight(i,j){
        while(j < boardMap[i].length - 1 && boardMap[i][j+1] === 0){
            boardMap[i][j+1] = -1;
            j++
        }
    }

    function checkStepUpLeft(i,j){
        while(i > 0 && j > 0 && boardMap[i-1][j-1] === 0){
            boardMap[i-1][j-1] = -1;
            i--
            j--
        }
    }

    function checkStepDownLeft(i,j){
        while(i < boardMap.length - 1 && j > 0 && boardMap[i+1][j-1] === 0){
            boardMap[i+1][j-1] = -1;
            i++
            j--
        }
    }

    function checkStepUpRight(i,j){
        while(i > 0 && j < boardMap[i].length - 1 && boardMap[i-1][j+1] === 0){
            boardMap[i-1][j+1] = -1;
            i--
            j++
        }
    }

    function checkStepDownRight(i,j){
        while(i < boardMap.length - 1 && j < boardMap[i].length - 1 && boardMap[i+1][j+1] === 0){
            boardMap[i+1][j+1] = -1;
            i++
            j++
        }
    }



</script>
</html>